name: ğŸ§ª Teste de Email Ã s 12:30

on:
  schedule:
    - cron: "30 15 * * *"   # 15:30 UTC = 12:30 BRT (horÃ¡rio de BrasÃ­lia)
  workflow_dispatch:         # Permite execuÃ§Ã£o manual
  push:
    branches: [ main, master ]
    paths:
      - 'teste_email_1130.py'
      - '.github/workflows/teste_email_1130.yml'

jobs:
  teste-email:
    runs-on: ubuntu-latest
    name: ğŸ“§ Teste de Email Ã s 12:30
    
    steps:
      - name: ğŸ“¥ Checkout do cÃ³digo
        uses: actions/checkout@v4
        
      - name: ğŸ Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: ğŸ“¦ Instalar dependÃªncias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: ğŸ§ª Executar teste de email Ã s 12:30
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          EMAIL_DESTINO: clevioferreira@gmail.com
        run: |
          echo "ğŸ• Executando teste de email Ã s 12:30..."
          echo "ğŸ“… Data/Hora: $(date)"
          echo "ğŸŒ Fuso horÃ¡rio: $(date +%Z)"
          echo "â° HorÃ¡rio local: $(date +%H:%M:%S)"
          echo ""
          
          python teste_email_1130.py
          
      - name: ğŸ“ Upload logs do teste
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: logs-teste-email-1130-${{ github.run_number }}
          path: |
            teste_email_1130.log
          retention-days: 30
          
      - name: ğŸ“Š Resumo do teste
        if: always()
        run: |
          echo "=== RESUMO DO TESTE DE EMAIL Ã€S 12:30 ==="
          echo "Data/Hora: $(date)"
          echo "Commit: ${{ github.sha }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "Workflow: ${{ github.workflow }}"
          echo "Status: ${{ job.status }}"
          echo "=========================================="
          
          if [ -f "teste_email_1130.log" ]; then
            echo ""
            echo "ğŸ“‹ Ãšltimas linhas do log:"
            tail -20 teste_email_1130.log
          fi
